<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä—É–≥ –∏ –ø–æ–¥–∞—Ä–æ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0088cc;
        }
        .canvas-container {
            margin: 20px 0;
            position: relative;
        }
        #drawingCanvas {
            border: 2px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            touch-action: none;
        }
        .button {
            background-color: #0088cc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #006da3;
        }
        .button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .payment-section {
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border: 1px solid #eee;
        }
        .stars {
            color: #ffcc00;
            font-size: 24px;
            margin: 10px 0;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .instructions {
            margin: 15px 0;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÅ –ö—Ä—É–≥ –∏ –ø–æ–¥–∞—Ä–æ–∫</h1>
        <p>–ù–∞—Ä–∏—Å—É–π—Ç–µ –∫—Ä—É–≥ –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫!</p>

        <div class="payment-section">
            <p>1 –ø–æ–ø—ã—Ç–∫–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Å—Ç–æ–∏—Ç</p>
            <div class="stars">5 –∑–≤—ë–∑–¥ ‚≠ê</div>
            <button id="paymentButton" class="button">–û–ø–ª–∞—Ç–∏—Ç—å 5 –∑–≤—ë–∑–¥</button>
        </div>

        <div class="instructions" id="instructions">
            –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤—ã —Å–º–æ–∂–µ—Ç–µ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∫—Ä—É–≥ –Ω–∞ —Ö–æ–ª—Å—Ç–µ
        </div>

        <div class="canvas-container">
            <canvas id="drawingCanvas" width="300" height="300" style="display:none;"></canvas>
        </div>

        <button id="checkButton" class="button" style="display:none;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—Ä—É–≥</button>
        <button id="resetButton" class="button" style="display:none;">–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>

        <div id="resultMessage" class="result"></div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const paymentButton = document.getElementById('paymentButton');
        const checkButton = document.getElementById('checkButton');
        const resetButton = document.getElementById('resetButton');
        const instructions = document.getElementById('instructions');
        const resultMessage = document.getElementById('resultMessage');

        let isDrawing = false;
        let hasPaid = false;
        let points = [];

        // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            points = [];
        }

        // –ù–∞—á–∞–ª–æ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        function startDrawing(e) {
            if (!hasPaid) return;

            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            ctx.beginPath();
            ctx.moveTo(x, y);
            points = [{x, y}];
        }

        // –ü—Ä–æ—Ü–µ—Å—Å —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        function draw(e) {
            if (!isDrawing) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            ctx.lineTo(x, y);
            ctx.stroke();
            points.push({x, y});
        }

        // –û–∫–æ–Ω—á–∞–Ω–∏–µ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        function stopDrawing() {
            isDrawing = false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ä–∏—Å—É–Ω–æ–∫ –ø–æ—Ö–æ–∂ –Ω–∞ –∫—Ä—É–≥
        function isCircle() {
            if (points.length < 10) return false;

            // –ù–∞—Ö–æ–¥–∏–º —Ü–µ–Ω—Ç—Ä —Ä–∏—Å—É–Ω–∫–∞
            let sumX = 0, sumY = 0;
            for (const point of points) {
                sumX += point.x;
                sumY += point.y;
            }
            const centerX = sumX / points.length;
            const centerY = sumY / points.length;

            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
            let sumDistance = 0;
            let distances = [];

            for (const point of points) {
                const distance = Math.sqrt(Math.pow(point.x - centerX, 2) + Math.pow(point.y - centerY, 2));
                sumDistance += distance;
                distances.push(distance);
            }

            const avgDistance = sumDistance / points.length;

            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
            let variance = 0;
            for (const distance of distances) {
                variance += Math.pow(distance - avgDistance, 2);
            }
            variance /= distances.length;
            const stdDev = Math.sqrt(variance);

            // –ï—Å–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –º–µ–Ω—å—à–µ 20% –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ –∫—Ä—É–≥–æ–º
            return stdDev < avgDistance * 0.2;
        }

        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function showResult(isSuccess, message) {
            resultMessage.textContent = message;
            resultMessage.className = 'result ' + (isSuccess ? 'success' : 'error');
            resultMessage.style.display = 'block';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã
        paymentButton.addEventListener('click', function() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ Telegram Mini Apps –¥–ª—è –æ–ø–ª–∞—Ç—ã
            tg.showPopup({
                title: "–û–ø–ª–∞—Ç–∞",
                message: "–° –≤–∞—à–µ–≥–æ —Å—á–µ—Ç–∞ –±—É–¥–µ—Ç —Å–ø–∏—Å–∞–Ω–æ 5 –∑–≤—ë–∑–¥. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?",
                buttons: [
                    {type: "ok", text: "–û–ø–ª–∞—Ç–∏—Ç—å"},
                    {type: "cancel", text: "–û—Ç–º–µ–Ω–∞"}
                ]
            }, function(buttonId) {
                if (buttonId === "ok") {
                    // –≠–º—É–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
                    hasPaid = true;
                    paymentButton.style.display = 'none';
                    canvas.style.display = 'block';
                    checkButton.style.display = 'inline-block';
                    resetButton.style.display = 'inline-block';
                    instructions.textContent = "–†–∏—Å—É–π—Ç–µ –∫—Ä—É–≥. –ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª–µ–µ —Ä–æ–≤–Ω—ã–º.";

                    // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
                    clearCanvas();

                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
                    tg.showPopup({
                        title: "–£—Å–ø–µ—à–Ω–æ",
                        message: "5 –∑–≤—ë–∑–¥ —É—Å–ø–µ—à–Ω–æ —Å–ø–∏—Å–∞–Ω—ã —Å –≤–∞—à–µ–≥–æ —Å—á–µ—Ç–∞!",
                        buttons: [{type: "ok", text: "OK"}]
                    });
                }
            });
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å—É–Ω–∫–∞
        checkButton.addEventListener('click', function() {
            if (points.length === 0) {
                showResult(false, "–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ä–∏—Å—É–π—Ç–µ –∫—Ä—É–≥!");
                return;
            }

            if (isCircle()) {
                showResult(true, "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ –Ω–∞—Ä–∏—Å–æ–≤–∞–ª–∏ –∫—Ä—É–≥. –í–∞—à –ø–æ–¥–∞—Ä–æ–∫: –ü—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å –Ω–∞ 7 –¥–Ω–µ–π!");

                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–¥–∞—á–∞ –Ω–∞–≥—Ä–∞–¥—ã
                tg.showPopup({
                    title: "–ü–æ–¥–∞—Ä–æ–∫ –ø–æ–ª—É—á–µ–Ω!",
                    message: "–í—ã –ø–æ–ª—É—á–∏–ª–∏ –ü—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å –Ω–∞ 7 –¥–Ω–µ–π!",
                    buttons: [{type: "ok", text: "–û—Ç–ª–∏—á–Ω–æ!"}]
                });

                // –ë–ª–æ–∫–∏—Ä—É–µ–º –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ
                hasPaid = false;
                checkButton.disabled = true;
            } else {
                showResult(false, "–≠—Ç–æ –Ω–µ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫—Ä—É–≥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
            }
        });

        // –°–±—Ä–æ—Å —Ä–∏—Å—É–Ω–∫–∞
        resetButton.addEventListener('click', function() {
            clearCanvas();
            resultMessage.style.display = 'none';
        });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è canvas
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            startDrawing(e.touches[0]);
        });

        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault();
            draw(e.touches[0]);
        });

        canvas.addEventListener('touchend', function(e) {
            e.preventDefault();
            stopDrawing();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        clearCanvas();
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#0088cc';
    </script>
</body>
</html>